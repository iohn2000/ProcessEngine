@using Kapsch.IS.EMD.EMD20Web.Models;
@model Kapsch.IS.EMD.EMD20Web.Models.CountryModel
@{
    ViewBag.Title = "Countries";
    ViewBag.Identifier = "CountryManagement";
    ViewBag.TooltipUrl = Request.Url.Scheme + "://" + Request.Url.Authority + "/Quickinfo/Country_Manage.html";
}

@Html.Partial("~/Views/Shared/Javascript/_TooltipMetaData.cshtml")


@if (Model.CanView || Model.CanManage)
{
    @(Html.Kendo().Grid<CountryModel>()
        .Name("Grid").HtmlAttributes(new { @class = "k-grid-big" })

        .Sortable()
        .Filterable(filterable => filterable.Mode(GridFilterMode.Row).Enabled(true))
          .Pageable(pageable => pageable
            .Refresh(true)
            .PageSizes(true)
            .ButtonCount(5)
            .PageSizes(new[] { 15, 50, 100 }))
        .Scrollable(s => s.Enabled(true).Height("auto"))
        .Columns(columns =>
        {
            columns.Bound(item => item.Guid).Title("")
            .ClientTemplate(
                                "# if (CanManage == true) { #"

                                + "<a title='Edit' href='\\#' "
                                + "onclick='showInWindow(\""
                                + "Edit/"
                                + "#= Guid #/true\",\"Edit Country\");' "
                                + "data-id='#=Guid#'"
                                + ">"
                                + "<i class='material-icons'>edit</i>"
                                + "</a>"
                                + "<a title='Delete' href='\\#' "
                                + "onclick='country.Functions.Delete(\"#=Guid#\",\"Country\",\"#=Name#\");' "
                                + "data-id='#=Guid#'"
                                + ">"
                                + "<i class='material-icons'>delete</i>"
                                + "</a>"

                                + "# } else {#"

                                + "<a title='View' href='\\#' "
                                + "onclick='showInWindow(\""
                                + "View/"
                                + "#= Guid #/true\",\"View Country\");' "
                                + "data-id='#=Guid#'"
                                + ">"
                                + "<i class='material-icons'>pageview</i>"
                                + "</a>"

                                + "#} #"
                              ).Width(60).Filterable(false);


            columns.Bound(item => item.Name).Filterable(ftb => ftb.Cell(cell => cell.Operator("contains").SuggestionOperator(FilterType.Contains).ShowOperators(false).Template("kendoHelper.DisableAutocompleteFilter")));
            columns.Bound(item => item.Code_A2).Filterable(ftb => ftb.Cell(cell => cell.Operator("contains").SuggestionOperator(FilterType.Contains).ShowOperators(false).Template("kendoHelper.DisableAutocompleteFilter")));
            columns.Bound(item => item.EU).Filterable(false);
            columns.Bound(item => item.ISO3166_A2).Filterable(ftb => ftb.Cell(cell => cell.Operator("contains").SuggestionOperator(FilterType.Contains).ShowOperators(false).Template("kendoHelper.DisableAutocompleteFilter")));
            columns.Bound(item => item.ISO3166_A3).Filterable(ftb => ftb.Cell(cell => cell.Operator("contains").SuggestionOperator(FilterType.Contains).ShowOperators(false).Template("kendoHelper.DisableAutocompleteFilter")));
            columns.Bound(item => item.ISO3166_N3).Filterable(ftb => ftb.Cell(cell => cell.Operator("contains").SuggestionOperator(FilterType.Contains).ShowOperators(false).Template("kendoHelper.DisableAutocompleteFilter")));
            columns.Bound(item => item.PhoneCode).Filterable(ftb => ftb.Cell(cell => cell.Operator("contains").SuggestionOperator(FilterType.Contains).ShowOperators(false).Template("kendoHelper.DisableAutocompleteFilter")));
            columns.Bound(item => item.UN_RoadCode).Filterable(ftb => ftb.Cell(cell => cell.Operator("contains").SuggestionOperator(FilterType.Contains).ShowOperators(false).Template("kendoHelper.DisableAutocompleteFilter")));
            columns.Bound(item => item.ActiveFromDateOnly).Format("{0:dd.MM.yyyy}").Width(200);

        })

        .Editable(editable => editable.Mode(GridEditMode.PopUp).DisplayDeleteConfirmation(false).Window(win => win.Width(700)))
        //.ToolBar(tb => tb.Custom().Text("Add Country").Url("#").HtmlAttributes(new { onclick = "showInWindow('Create/true','Add Country',false);", @class = "kapsch-text-button" }))
        .ToolBar(tb =>
        {
            if (Model.CanManage)
            {
                tb.Custom().Text("Add Country").Url("#").HtmlAttributes(new { onclick = "showInWindow('Create/true','Add Country',false);", @class = "kapsch-text-button" });
            }
            //tb.Custom().Text("Clear Filter").Url("#").HtmlAttributes(new { onclick = "kendoHelper.Grid.ClearFilter('#Grid');", @class = "kapsch-text-button" });
        })
        .DataSource(dataSource => dataSource
            .Ajax()
            .ServerOperation(true)
            .Sort(a => {
                a.Add("Name").Ascending();
                a.Add("Code_A2").Ascending();
            })
            .PageSize(15)
            .Model(model => model.Id(item => item.Guid))
            .Read(read => read.Action("Read", "Country"))
            .Events(events => events.Error("exceptionManager.Events.HandleError"))
        )
    )

    <script type="text/javascript">
    $(document).ready(function () {
        var url = '@Request.Url';
        kendoHelper.Grid.FilterGrid('#Grid', "Guid", "equals", url);
    });
    </script>
}

